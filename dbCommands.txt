-- before creating any table , enable pg vector

CREATE EXTENSION IF NOT EXISTS vector;


-- Create products table

CREATE TABLE products (
    id TEXT PRIMARY KEY,
    name TEXT NOT NULL,
    barcode TEXT,
    description TEXT,
    basePrice FLOAT,
    categoryName TEXT,
    brand TEXT,
    tags JSONB,
    variants JSONB,
    attributes JSONB,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);


-- Create product embeddings table

CREATE TABLE product_embeddings (
    product_id TEXT REFERENCES products(id) ON DELETE CASCADE,
    embedding VECTOR(768),
    PRIMARY KEY(product_id)
);

CREATE INDEX ON product_embeddings USING ivfflat (embedding vector_cosine_ops);


-- Create services table

CREATE TABLE services (
    id TEXT PRIMARY KEY,
    name TEXT NOT NULL,
    description TEXT,
    basePrice FLOAT,
    categoryName TEXT,
    tags JSONB,
    packages JSONB,
    attributes JSONB,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);


-- Create service embeddings table

CREATE TABLE service_embeddings (
    service_id TEXT REFERENCES services(id) ON DELETE CASCADE,
    embedding VECTOR(768),
    PRIMARY KEY(service_id)
);

CREATE INDEX ON service_embeddings USING ivfflat (embedding vector_cosine_ops);